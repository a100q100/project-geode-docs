<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE concept PUBLIC "-//OASIS//DTD DITA Concept//EN" "concept.dtd">
<concept id="client-load-balancing">
	<title>Connection Pools</title>
	<shortdesc>Clients contain connection pools. Each region is associated with a connection pool
		using a region attribute, and operations on the region use connections from the respective
		pools. </shortdesc>
	<conbody>
		<p>The server connectivity options are specified in the connection pool configuration. Each
			pool has a minimum and maximum number of connections. </p>
		<p>Each cache operation that requires server connectivity obtains a connection from the pool
			for the server group that the operation affects, performs the operation using the
			connection, and returns the connection to the pool. If the pool size is less than the
			maximum number of connections and all connections are in use, the connection pool
			creates a new connection and returns it. If the pool is at the maximum number of
			connections, that thread blocks until a connection becomes available or a
				<codeph>free-connection-timeout</codeph> occurs. If a
				<codeph>free-connection-timeout</codeph> occurs, an
				<codeph>AllConnectionsInUse</codeph> exception is thrown. </p>
		<p>The connection pool has a configurable timeout period that is used to expire idle connections.
			The idle connections are expired until the pool has the minimum number of connections. A
			monitoring thread expires idle connections, adds sufficient connections to bring up the
			count to minimum, closes connections whose lifetime has been exceeded. See the
				<codeph>load-conditioning-interval</codeph> and <codeph>idle-timeout</codeph>
			attributes of the <xref href="../../reference/topics/client-cache.xml#cc-pool"/>
			element. A separate thread (ping) tests each connected endpoint for its status and if
			the endpoint is not reachable, the thread closes all connections that have been made to
			the endpoint. See the <codeph>ping-interval</codeph> attribute of the &lt;pool>
			element>. </p>
		<fig id="fig_226964BAA1464DBA9F5CEDC2CB7B3585">
			<title>Logical Architecture of Client/Server Connections</title>
			<image href="../common/images/client-server-arch.gif"
				id="image_1E8316666E1B4CC2ADE4D927B629E49F"/>
			<p>When a connection receives an exception, the operation is failed over to another
				connection from the pool. The failover mechanism obtains the endpoint to failover to
				from the locator or from the specified endpoint list in the pool. </p>
		</fig>
	</conbody>
</concept>
