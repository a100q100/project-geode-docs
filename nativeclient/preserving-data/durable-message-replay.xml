<?xml version="1.0"?>
<!DOCTYPE concept PUBLIC "-//OASIS//DTD DITA Concept//EN" "concept.dtd">
<concept
	id="concept_954CDD278E3C4F9280B6B382D42FF690">
	<title>Durable Message Replay</title>
	<shortdesc>When the primary server receives the cache ready message, the servers and client
		execute a procedure to update the queue and replay the events from the stored messages. </shortdesc>
	<conbody>
		<p>Durable message replay proceeds as follows. To avoid overwriting current entries with old
			data, the client does not apply the updates to its cache. </p>
		<ol
			id="ol_29ED466C3DB6422693DF50077406E69C">
			<li id="li_E6471B4766814E9DADF1A05CDC4D133B"> The server finds the queue for this durable client
				ID and updates its information, including the clientâ€™s socket and remote ports.
					<p>If the client has timed out while it was disconnected, its queues are gone
					and the server then treats it as a new client. See <xref
						href="initial-operation.xml"/>. </p>
			</li>
			<li
				id="li_FA05E92E6BF44E0987DD3AD73DC395E0">All servers that have a queue for this
				client place a marker in the queue. <p>Messages in the queue before the marker are
					considered to have come while the client was disconnected. Messages after the
					marker are handled normally. </p></li>
			<li
				id="li_02D503C9D9B049BEBC79C28EEE339C1F">The cache server sends the queued messages
				to the client. This includes any messages that were evicted to disk. </li>
			<li
				id="li_7D36FD938F494B26BDE3178DF7FBB0AD">The client receives the messages but does
				not apply the updates to its cache. If cache listeners are installed, they handle
				the events. For implications, see <xref
					href="impl-cache-listeners-durable-clients.xml#concept_3BD651087FC4470C8BAB6AFD97AEA689"
					type="concept"
					format="dita"
					scope="local">Implementing Cache Listeners for Durable Clients</xref>. </li>
			<li
				id="li_F4CF8EC3BC0743F8A11139F3541A0364">The client receives the marker message
				indicating that all past events have been played back. </li>
			<li
				id="li_1F8B99B6D14F499F9F2A873D1B3EEBD4">The cache server sends the current list of
				live regions. </li>
			<li
				id="li_D50594B9F4EC4245B47230666DFA5DCB">In each live region on the client, the
				marker event triggers the <codeph>afterRegionLive</codeph> callback. <p>After the
					callback, the client begins normal processing of events from the server and
					applies the updates to its cache. </p></li>
		</ol>
		<p>Even when a new client starts up for the first time, the cache ready markers are inserted
			in the queues. If messages start coming into the new queues before the servers insert
			the marker, those messages are considered as having happened while the client was
			disconnected, and their events are replayed the same as in the reconnect case. </p>
	</conbody>
</concept>
